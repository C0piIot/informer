{% extends 'base.html' %}
{% load i18n %}


{% block breadcrumbds %}
<li class="breadcrumb-item"><a href="{% url 'home' %}">{% translate "Home" %}</a></li>
<li class="breadcrumb-item active" aria-current="page">{% translate "Channels" %}</li>
{% endblock breadcrumbds %}

{% block body-content %}
{{ block.super }}
<div class="container">
	<div class="dropdown mt-4">
		<button class="btn btn-secondary dropdown-toggle" type="button" id="newChannel" data-bs-toggle="dropdown" aria-expanded="false">
		{% translate "New channel" %}
		</button>
  		<ul class="dropdown-menu" aria-labelledby="newChannel">
		    {% for content_type in new_channel_forms.keys %}
                <li>
                    <a class="dropdown-item" data-bs-toggle="modal" href="#modal-add-{{ content_type.model }}">
                        {{ content_type.name|title }}
                    </a>
                </li>
		    {% endfor %}
		</ul>
	</div>
	<div class="table-responsive">
		<table class="table table-hover">
			<tbody>
    			{% for channel in object_list %}
    			<tr>
    				<td class="w-100">
    					<a href="#" title="{% translate 'View' %}" class="text-decoration-none">
    						{{ channel }}	
    					</a>
    				</td>
    				<td class="text-nowrap">
    					<a href="" title="{% translate 'Edit' %}" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modal-edit-{{ channel.pk }}">
    						✏️
    					</a>
    					<button title="{% translate 'Remove' %}" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#modal-delete-{{ channel.pk }}">
    						❌
    					</button>
    				</td>
    			</tr>
    			{% endfor %}
    		</tbody>
		</table>
	</div>
</div>
{% for content_type, form in new_channel_forms.items %}
<form method="post" 
	action="{% url 'configuration:channel_create' content_type.model %}"
    id="modal-add-{{ content_type.model }}" 
  	aria-labelledby="modal-new-{{ content_type.model }}-title"
  	class="modal {{ content_type.model }}" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-xl">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="modal-new-{{ content_type.model }}-title">
	            {% blocktranslate with name=content_type.name %}Add {{ name }}{% endblocktranslate %}
	        </h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% translate 'Close' %}"></button>
	      </div>
          <div class="modal-body">{% include "configuration/channels/"|add:content_type.model|add:".html" %}</div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% translate "Cancel" %}</button>
	        <button type="submit" class="btn btn-primary">{% translate "Save" %}</button>
	      </div>
	    </div>
  	</div>
    {% csrf_token %}
</form>
{% endfor %}
{% for form in channel_forms %}
<form method="post" 
    action="{% url 'configuration:channel_update' form.instance.pk %}"
    id="modal-edit-{{ form.instance.pk }}" 
    aria-labelledby="modal-edit-{{ form.instance.pk }}-title"
    class="modal {{ form.instance.content_type.model }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modal-edit-{{ form.instance.pk }}-title">
                {% blocktranslate with type=form.instance.content_type.name %}Edit channel {{ form.instance.name }}{% endblocktranslate %}
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% translate 'Close' %}"></button>
          </div>
          <div class="modal-body">{% include "configuration/channels/"|add:form.instance.content_type.model|add:".html" %}</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% translate "Cancel" %}</button>
            <button type="submit" class="btn btn-primary">{% translate "Update" %}</button>
          </div>
        </div>
    </div>
    {% csrf_token %}
</form>
<form method="post" 
    action="{% url 'configuration:channel_remove' form.instance.pk %}"
    id="modal-delete-{{ form.instance.pk }}" 
    aria-labelledby="modal-delete-{{ form.instance.pk }}-title"
    class="modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modal-delete-{{ form.instance.pk }}-title">
                {% blocktranslate %}Remove channel {{ form.instance.name }}{% endblocktranslate %}
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% translate 'Close' %}"></button>
          </div>
          <div class="modal-body">
              {% translate "Are you sure?" %}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% translate "Cancel" %}</button>
            <button type="submit" class="btn btn-danger">{% translate "Delete" %}</button>
          </div>
        </div>
    </div>
    {% csrf_token %}
</form>
{% endfor %}
{% endblock body-content %}